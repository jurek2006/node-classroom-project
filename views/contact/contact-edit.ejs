<%- include('../includes/html-head.ejs') %>

    <%
        <!-- if contact given we're editing contact or contact details view, otherwise adding new contact -->
        let defaults = {
            firstName: '',
            lastName: ''
        }
        if(contact){
            defaults = {...contact}
        }
    %>


    <form action="/contact/save" method="POST">
        <!-- for editing contact when editMode is not set - editing is disabled -->
        <input type="text" name="firstName" id="firstName" value="<%= defaults.firstName %>" <%= contact && !editMode ? "disabled" : "" %>>
        <input type="text" name="lastName" id="lastName" value="<%= defaults.lastName %>" <%= contact && !editMode ? "disabled" : "" %>>

        <% if (contact && editMode){ %>
                <!-- editing contact -->
                <button type="submit">Update contact</button>
                <a href="<%= contact.id%>/delete">Delete contact</a>
                <a href="<%= contact.id%>">Cancel</a>
        <% } else if(contact && !editMode) { %>
                <!-- contact's detail view -->
                <a href="?edit=true">Edit</a>
                <a href="/contact/list">Back to contacts list</a>

        <% } else { %>
            <!-- adding new contact -->
            <button type="submit">Save contact</button>
            <a href="/contact/list">Cancel</a>
        <% } %>
        
        
        <%- contact ? `<input type="hidden" name="id" value="${contact.id}" >` :""%>
    </form>

    <% if (contact && coursesEnrolled && coursesEnrolled.length > 0){ %>
    <!-- if contact enrolled to any course - show list of contact's courses -->
    <!-- has to be outside form above -->
    <h2>Contact enrolled to courses:</h2>
    <ul>
        <% for(let course of coursesEnrolled) { %>
        <li>
            <a href="/course/<%= course.id %>"><%= course.courseName %></a>
    
            <!-- form to disenroll contact from a course using post -->
            <form action="/course/disenroll/ %>" method="POST">
                <input type="hidden" name="courseId" value="<%= course.id %>" />
                <input type="hidden" name="contactId" value="<%= contact.id %>" />
                <input type="hidden" name="redirectBackPath" value="<%= locals.path %>" />
                <button>disenroll</button>
            </form>
        </li>
        <% } %>
    </ul>
    <% } else { %>
    <h2>Not enrolled to any course yet.</h2>
    <% }%>

<%- include('../includes/html-end.ejs') %>
    


